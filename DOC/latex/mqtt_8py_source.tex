\hypertarget{mqtt_8py_source}{}\doxysection{mqtt.\+py}
\label{mqtt_8py_source}\index{jupyterLab/playsound-\/on-\/a-\/trigger-\/asink/mqtt.py@{jupyterLab/playsound-\/on-\/a-\/trigger-\/asink/mqtt.py}}
\mbox{\hyperlink{mqtt_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00001}\mbox{\hyperlink{namespacemqtt}{00001}} \textcolor{comment}{\# python 3.6}}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00003}00003 \textcolor{keyword}{import} random}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00004}00004 \textcolor{keyword}{import} time}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00005}00005 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00006}00006 \textcolor{keyword}{from} paho.mqtt \textcolor{keyword}{import} client \textcolor{keyword}{as} mqtt\_client}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00007}00007 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00008}00008 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00009}\mbox{\hyperlink{namespacemqtt_a6ea40616dbcf7aa672effa8c9698e91e}{00009}} broker = \textcolor{stringliteral}{'broker.emqx.io'}}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00010}\mbox{\hyperlink{namespacemqtt_a2761d8d2d50d93a8e528737fbe95167e}{00010}} port = 1883}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00011}\mbox{\hyperlink{namespacemqtt_a71cb992573d174ca8319de2c53c274c9}{00011}} topic = \textcolor{stringliteral}{"{}python/mqtt"{}}}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00012}00012 \textcolor{comment}{\# generate client ID with pub prefix randomly}}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00013}\mbox{\hyperlink{namespacemqtt_a5e7c086d73fb9df1bddb16348af24f70}{00013}} client\_id = f\textcolor{stringliteral}{'python-\/mqtt-\/\{random.randint(0, 1000)\}'}}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00014}00014 \textcolor{comment}{\# username = 'emqx'}}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00015}00015 \textcolor{comment}{\# password = 'public'}}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00018}\mbox{\hyperlink{namespacemqtt_ac56cb403c0e00a184e8d17c5b17844d1}{00018}} \textcolor{keyword}{def }\mbox{\hyperlink{namespacemqtt_ac56cb403c0e00a184e8d17c5b17844d1}{connect\_mqtt}}():}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00019}00019     \textcolor{keyword}{def }on\_connect(client, userdata, flags, rc):}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00020}00020         \textcolor{keywordflow}{if} rc == 0:}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00021}00021             print(\textcolor{stringliteral}{"{}Connected to MQTT Broker!"{}})}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00022}00022         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00023}00023             print(\textcolor{stringliteral}{"{}Failed to connect, return code \%d\(\backslash\)n"{}}, rc)}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00025}00025     client = mqtt\_client.Client(client\_id)}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00026}00026     client.username\_pw\_set(username, password)}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00027}00027     client.on\_connect = on\_connect}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00028}00028     client.connect(broker, port)}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00029}00029     \textcolor{keywordflow}{return} client}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00032}\mbox{\hyperlink{namespacemqtt_ade0576775e7ca369a2fe649952b99a15}{00032}} \textcolor{keyword}{def }\mbox{\hyperlink{namespacemqtt_ade0576775e7ca369a2fe649952b99a15}{publish}}(client):}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00033}00033     msg\_count = 0}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00034}00034     \textcolor{keywordflow}{while} \textcolor{keyword}{True}:}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00035}00035         time.sleep(1)}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00036}00036         msg = f\textcolor{stringliteral}{"{}messages: \{msg\_count\}"{}}}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00037}00037         result = client.publish(topic, msg)}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00038}00038         \textcolor{comment}{\# result: [0, 1]}}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00039}00039         status = result[0]}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00040}00040         \textcolor{keywordflow}{if} status == 0:}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00041}00041             print(f\textcolor{stringliteral}{"{}Send `\{msg\}` to topic `\{topic\}`"{}})}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00042}00042         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00043}00043             print(f\textcolor{stringliteral}{"{}Failed to send message to topic \{topic\}"{}})}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00044}00044         msg\_count += 1}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00045}00045 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00046}00046 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00047}\mbox{\hyperlink{namespacemqtt_a7e05d49b2ec875b812003fe651339658}{00047}} \textcolor{keyword}{def }\mbox{\hyperlink{namespacemqtt_a7e05d49b2ec875b812003fe651339658}{run}}():}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00048}00048     client = \mbox{\hyperlink{namespacemqtt_ac56cb403c0e00a184e8d17c5b17844d1}{connect\_mqtt}}()}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00049}00049     client.loop\_start()}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00050}00050     \mbox{\hyperlink{namespacemqtt_ade0576775e7ca369a2fe649952b99a15}{publish}}(client)}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00051}00051 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00052}00052 }
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00053}00053 \textcolor{keywordflow}{if} \_\_name\_\_ == \textcolor{stringliteral}{'\_\_main\_\_'}:}
\DoxyCodeLine{\Hypertarget{mqtt_8py_source_l00054}00054     \mbox{\hyperlink{namespacemqtt_a7e05d49b2ec875b812003fe651339658}{run}}()}

\end{DoxyCode}
